---
title: "数据库调优"
date: 2022-12-08T10:08:56+08:00
draft: true
keywords: ["postgres"]
description: ""
tags: [""]
keywords: [""]
author: "y1nhui"

# Uncomment to pin article to front page
# weight: 1
# You can also close(false) or open(true) something for this content.
# P.S. comment can only be closed
comment: false
toc: true
autoCollapseToc: false
# You can also define another contentCopyright. e.g. contentCopyright: "This is another copyright."
contentCopyright: false
reward: false
mathjax: false

# Uncomment to add to the homepage's dropdown menu; weight = order of article
# menu:
#   main:
#     parent: "docs"
#     weight: 1
---

<!--more-->
---

# PG 数据库调优

docker 启动数据库
`docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -p 5432:5432 -d postgres`


自增： 

`generated by default as identity`
## 分区表

分区的三种方式：

- 范围分区
- 列表分区
- 哈希分区

通过触发器触发函数创建分取表

函数使用语言 plpgsql

` as $function$ ` 含义

分区可以使用内置分区来创建，但是内置分区有两个问题

1. 自动创建子表
2. 主区的主键除本来可能的id，还有分区用的列

自动创建子表 有方法： https://cloud.tencent.com/document/product/409/72286

主键？

## 数据库添加索引

pg 11 之后，分取表不在需要自动创建索引，可以基于主表自动创建


性能预估： explain select xxx 可以让pg模拟操作需要耗费的时间等



创建索引原则

## elasticsearch + 数据库